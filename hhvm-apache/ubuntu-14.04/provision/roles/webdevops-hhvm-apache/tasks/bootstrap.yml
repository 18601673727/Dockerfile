---

- action: setup

- name: Setup hhvm run directory
  file:
    path:  /var/run/hhvm/
    state: directory
    mode:  0700
    owner: "{{ DOCKER.APPLICATION_USER }}"

- name: Setup hhvm
  lineinfile:
    dest:   "/etc/hhvm/{{ item.file }}"
    regexp: '^[\s;]*{{ item.key }}[\s]*='
    line:   '{{ item.key }} = {{ item.value }}'
  with_items:
   - { file: "server.ini", key: 'hhvm.server.ip', value: "127.0.0.1" }
   - { file: "php.ini", key: 'hhvm.server.fix_path_info', value: "true" }

- name: Enable apache main config
  file:
    src:  '/opt/docker/etc/httpd/main.conf'
    dest: '/etc/apache2/sites-enabled/10-docker.conf'
    state: link
    force: yes
