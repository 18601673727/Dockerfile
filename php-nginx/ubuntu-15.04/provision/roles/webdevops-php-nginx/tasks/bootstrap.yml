---

- name: Diable nginx demonize mode
  lineinfile:
    dest:   /etc/nginx/nginx.conf
    regexp: '^[\s;]*{{ item.key }}[\s]*='
    line:   '{{ item.key }} {{ item.value }};'
  with_items:
   - { key: 'daemon', value: "off" }

- name: Restrict php-fpm to local connection
  lineinfile:
    dest:   /etc/php5/fpm/pool.d/www.conf
    regexp: '^[\s;]*{{ item.key }}[\s]*='
    line:   '{{ item.key }} = {{ item.value }}'
  with_items:
   - { key: 'listen', value: "127.0.0.1:9000" }

- name: Enable nginx main config
  file:
    src:  '/opt/docker/etc/nginx/main.conf'
    dest: '/etc/nginx/conf.d/10-docker.conf'
    state: link
    force: yes
